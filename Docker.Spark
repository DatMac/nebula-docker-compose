FROM bitnami/spark:2.4.4-debian-10-r13

USER root

RUN echo "deb http://archive.debian.org/debian/ buster main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security/ buster/updates main" >> /etc/apt/sources.list

RUN apt-get update && \
    apt-get install -y --no-install-recommends python3.7 python3-pip && \
    rm -rf /var/lib/apt/lists/*

RUN python3.7 -m pip install \
    dataclasses \
    "Faker==14.2.1" \
    "typing-extensions==4.1.1"

RUN ln -s /usr/bin/python3.7 /usr/local/bin/python3

RUN groupadd --system --gid 1001 sparky && \
    useradd --system --uid 1001 --gid sparky --shell /bin/bash --create-home sparky && \
    chown -R sparky:sparky /opt/bitnami/spark

USER sparky
